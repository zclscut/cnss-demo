%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%ä¸??1minæ¨¡æ‹Ÿä¿¡å·çš„PCMé‡‡æ ·é‡åŒ–ç¼–ç 
% 1.ç”¨aç‡è¿›è¡Œéå‡åŒ€é‡åŒ–
% 2.é‡åŒ–ç¼–ç åä¸€ä¸ªç”µå¹³å¾—åˆ?bitç å­—
%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%
clear all;
[x,fs]=audioread('music.wav');
% sound(x,fs)%æ’­æ”¾åŸéŸ³
N=length(x);
t=0:1/fs:(N-1)/fs;

% noise_high=0.1*sin(2*pi*5000*t)%5kHzé«˜é¢‘å™ªå£°
% noise_low=sin(2*pi*100*t)%100Hzä½é¢‘å™ªå£°
x1=x(:,1);%æŠ½å–xç¬?å£°é“
start=fs*10;%ä»ç¬¬10ç§’å¼€å§‹æ’­æ”?
inteval=150;%æˆªå–é•¿åº¦
% figure
% subplot(2,1,1);
% plot(x1(start:start+inteval,1));
% grid;
% subplot(2,1,2);
% stem(x1(start:start+inteval,1));%é‡‡æ ·é‡åŒ–å¤„ç†å¯¹è±¡
% stem(x1);
% grid;
pcm_code = quantization(x1);
% signal = dquantization(pcm_code);
% figure;
% subplot(211);
% plot(x1);
% subplot(212);
% plot(signal);
% audiowrite('dq_test.wav',signal,fs);

%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%äºŒã?åŸºå¸¦è°ƒåˆ¶å¹¶æ˜¾ç¤ºæ³¢å½?
%1.16FSKå’?6QAMè°ƒåˆ¶
%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%


test_in=[0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,1,0,1,0,0,0,1,0,1,0,1,1,0,0,1,1,1,1,0,0,0,1,0,0,1,1,0,1,0,1,0,1,1,1,1,0,0,1,1,0,1,1,1,1,0,1,1,1,1];
cut=4;%å°†æ¯4ä½åˆ‡ç‰?
test_in=reshape(test_in,cut,[]);%[]è‡ªåŠ¨è®¡ç®—ç»´åº¦å¤§å°
fsk16=[];
t=0:0.01:1;
symbols=8;%æ˜¾ç¤º1~8ä¸ªç å­?
w_fsk=2*pi;%å‘¨æœŸä¸?
for i = 1:symbols
    num=bin2dec(num2str(test_in(:,i)'));%è¯»å–4ä½æ•°ç»„è½¬åŒ–ä¸ºåè¿›åˆ¶ï¼Œå†å¯¹16bitä¿¡æ¯ä½è¿›è¡?6fskè°ƒåˆ¶æˆ–è?16qamè°ƒåˆ¶
    fsk16=[fsk16,sin((num+1)*w_fsk*t)];%ç”?num+1)è¿›è¡Œé¢‘ç‡è°ƒåˆ¶
end

figure
subplot(2,1,1)
carrier=repmat(sin(w_fsk*t)',symbols,1);
plot(carrier);
title('è½½æ³¢æ³¢å½¢')
subplot(2,1,2)
plot(fsk16);%ç”»å‡º16fskçš„æ³¢å½?
title('16fskè°ƒåˆ¶æ³¢å½¢')


%16QAMæ˜Ÿåº§å›?
constell_diag=[1 1;1 3;1 -1;1 -3;3 1;3 3;3 -1;3 -3;-1 1;-1 3;-1 -1;-1 -3;-3 1;-3 3;-3 -1;-3 -3];
%èƒ½é‡å½’ä¸€åŒ?(2,2)å½’ä¸€åŒ–æ¨¡ä¸?
constell_diag=constell_diag./2/sqrt(2);
qam16=[];
t=0:0.01:1;
w_qam=2*pi*4;%å‘¨æœŸä¸?/4,ä¸ºäº†å¯è§†åŒ–æ›´å¥½çœ‹ï¼Œä½¿æ¨¡æ‹Ÿå‘¨æœŸÃ—4=ç å…ƒå‘¨æœŸ
symbols=4;%æ˜¾ç¤º1~4ä¸ªç å­?
for i = 1:symbols
    num=bin2dec(num2str(test_in(:,i)'));%è¯»å–4ä½æ•°ç»„è½¬åŒ–ä¸ºåè¿›åˆ¶ï¼Œå†å¯¹16bitä¿¡æ¯ä½è¿›è¡?6fskè°ƒåˆ¶æˆ–è?16qamè°ƒåˆ¶
    qam_sig=constell_diag(num+1,1)*cos(w_qam*t)+constell_diag(num+1,2)*sin(w_qam*t);
    qam16=[qam16,qam_sig];%ç”?num+1)è¿›è¡Œé¢‘ç‡è°ƒåˆ¶
end

figure
subplot(2,1,1)
carrier=repmat(cos(w_qam*t)',symbols,1);
plot(carrier);
title('è½½æ³¢æ³¢å½¢')
subplot(2,1,2)
plot(qam16);%ç”»å‡º16qamçš„æ³¢å½?
title('16qamè°ƒåˆ¶æ³¢å½¢')





%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%ä¸‰ã?é«˜æ–¯ä¿¡é“ä¼ è¾“ï¼Œä¿¡å·è§£è°?
%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%




















%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%å››ã?æŠ½æ ·åˆ¤å†³ï¼Œç»Ÿè®¡è¯¯ç ç‡
%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%



























